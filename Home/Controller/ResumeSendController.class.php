<?php
// +----------------------------------------------------------------------
// | [ Believe in yourself ] [Keep on going never give up]
// +----------------------------------------------------------------------
// | team:Five Over 
// +----------------------------------------------------------------------
// | Author:陈仁焕 <sign0318@126.com>
// +----------------------------------------------------------------------
// | Date
// +----------------------------------------------------------------------
/**
*类介绍
*	简历的投递和各种状态
*/
namespace Home\Controller;
use Think\Controller;
class ResumeSendController extends BaseController {
	public function __construct(){
		parent::__construct();
		if(!session('?user')){
			header('location:'.__APP__);
		}
	}
	public function index(){
		header('location:/index.php/Home/ResumeSend/allSend.html');
	}
	public function allSend(){
		//显示头部用户名
		$user=M('users');
		$id=session('user.id');
		$res_user=$user->where("id=$id")->find();
		if($res_user){
			$this->data['username']=$res_user['username'];
		}
		//投递职位的遍历
		$topshow['all_show']='current';
		$send=M('send');
		$company=M('company');
		$job=M('job');
		$res_send=$send->where("user_id=$id")->select();
		if($res_send){
			foreach($res_send as $key=>$value){
				$arr=$value;
				//first
				if($value['state1']==1){
					$arr['state_1']='done';
					$arr['state_1_show']='top';
					$arr['state_1_time']=$res_send['state1_time'];
					$arr['state_1_dn']='';
				}else{
					$arr['state_1']='grey';
					$arr['state_1_show']='bottom';
					$arr['state_1_dn']='dn';
				}
				//second	
				if($value['state2']==1){
					$arr['state_2']='done';
					$arr['state_2_show']='top';
					$arr['state_2_time']=$res_send['state2_time'];
					$arr['state_2_dn']='';
				}else{
					$arr['state_2']='grey';
					$arr['state_2_show']='bottom';
					$arr['state_2_dn']='dn';
				}
				//third
				if($value['state3']==0){
					$arr['state_3']='grey';
					$arr['state_3_value']='被转发';
					$arr['state_3_show']='bottom';
					$arr['state_3_dn']='dn';
				}elseif($value['state3']==1){
					$arr['state_3']='done';
					$arr['state_3_value']='被转发';
					$arr['state_3_show']='top';
					$arr['state_3_time']=$res_send['state3_time'];
					$arr['state_3_dn']='';
				}else{
					$arr['state_3']='done';
					$arr['state_3_value']='通过初筛';
					$arr['state_3_show']='top';
					$arr['state_3_time']=$res_send['state3_time'];
					$arr['state_3_dn']='';
				}
				//fourth
				if($value['state4']==0){
					$arr['state_4']='grey';
					$arr['state_4_value']='通知面试';
					$arr['state_4_show']='bottom';
					$arr['state_4_say']=$res_send['content'];
					$arr['state_4_dn']='dn';
				}elseif($value['state4']==1){
					$arr['state_4']='done';
					$arr['state_4_value']='通知面试';
					$arr['state_4_show']='top';
					$arr['state_4_time']=$res_send['state4_time'];
					$arr['state_4_say']=$res_send['content'];
					$arr['state_4_dn']='';
				}else{
					$arr['state_4']='done';
					$arr['state_4_value']='不合适';
					$arr['state_4_show']='top';
					$arr['state_4_time']=$res_send['state4_time'];
					$arr['state_4_say']=$res_send['content'];
					$arr['state_4_dn']='';
				}
				$res_job=$job->where("id={$arr['job_id']}")->find();
				if($res_job){
					$arr['job']=$res_job;
				}
				$res_company=$company->where("id={$arr['company_id']}")->find();
				if($res_company){
					$arr['company']=$res_company;
				}
				$result[]=$arr;
			}
		}
		//var_dump($result);
		//显示用户投递的职位
		$this->assign('data',$this->data);
		$this->assign('result',$result);
		$this->assign('topshow',$topshow);
		$this->display('ResumeSend/index');	
	}
	//查看过的简历
	public function lookSuccess(){
		$user=M('users');
		$id=session('user.id');
		$res_user=$user->where("id=$id")->find();
		if($res_user){
			$this->data['username']=$res_user['username'];
		}
		//投递职位的遍历
		$topshow['look_show']='current';
		$send=M('send');
		$company=M('company');
		$job=M('job');
		$res_send=$send->where("user_id=$id")->select();
		if($res_send){
			foreach($res_send as $key=>$value){
				//second	
				if($value['state2']==1){
					$arr=$value;
					$arr['state_2']='done';
					$arr['state_2_show']='top';
					$arr['state_2_time']=$res_send['state2_time'];
					$arr['state_2_dn']='';
					//first
					if($value['state1']==1){
						$arr['state_1']='done';
						$arr['state_1_show']='top';
						$arr['state_1_time']=$res_send['state1_time'];
						$arr['state_1_dn']='';
					}else{
						$arr['state_1']='grey';
						$arr['state_1_show']='bottom';
						$arr['state_1_dn']='dn';
					}
					//third
					if($value['state3']==0){
						$arr['state_3']='grey';
						$arr['state_3_value']='被转发';
						$arr['state_3_show']='bottom';
						$arr['state_3_dn']='dn';
					}elseif($value['state3']==1){
						$arr['state_3']='done';
						$arr['state_3_value']='被转发';
						$arr['state_3_show']='top';
						$arr['state_3_time']=$res_send['state3_time'];
						$arr['state_3_dn']='';
					}else{
						$arr['state_3']='done';
						$arr['state_3_value']='通过初筛';
						$arr['state_3_show']='top';
						$arr['state_3_time']=$res_send['state3_time'];
						$arr['state_3_dn']='';
					}
					//fourth
					if($value['state4']==0){
						$arr['state_4']='grey';
						$arr['state_4_value']='通知面试';
						$arr['state_4_show']='bottom';
						$arr['state_4_say']=$res_send['content'];
						$arr['state_4_dn']='dn';
					}elseif($value['state4']==1){
						$arr['state_4']='done';
						$arr['state_4_value']='通知面试';
						$arr['state_4_show']='top';
						$arr['state_4_time']=$res_send['state4_time'];
						$arr['state_4_say']=$res_send['content'];
						$arr['state_4_dn']='';
					}else{
						$arr['state_4']='done';
						$arr['state_4_value']='不合适';
						$arr['state_4_show']='top';
						$arr['state_4_time']=$res_send['state4_time'];
						$arr['state_4_say']=$res_send['content'];
						$arr['state_4_dn']='';
					}
					$res_job=$job->where("id={$arr['job_id']}")->find();
					if($res_job){
						$arr['job']=$res_job;
					}
					$res_company=$company->where("id={$arr['company_id']}")->find();
					if($res_company){
						$arr['company']=$res_company;
						$result[]=$arr;	
					}
				}			
			}
		}
		//var_dump($result);
		//var_dump($res_send);
		//显示用户投递的职位
		$this->assign('topshow',$topshow);
		$this->assign('data',$this->data);
		$this->assign('result',$result);
		$this->display('ResumeSend/index');			
	}
	//被转发的简历
	public function resendSuccess(){
		$user=M('users');
		$id=session('user.id');
		$res_user=$user->where("id=$id")->find();
		if($res_user){
			$this->data['username']=$res_user['username'];
		}
		//投递职位的遍历
		$topshow['resend_success']='current';
		$send=M('send');
		$company=M('company');
		$job=M('job');
		$res_send=$send->where("user_id=$id")->select();
		if($res_send){
			foreach($res_send as $key=>$value){
				//second
				if($value['state3']==1){
					$arr=$value;
					$arr['state_3']='done';
					$arr['state_3_value']='被转发';
					$arr['state_3_show']='top';
					$arr['state_3_time']=$res_send['state3_time'];
					$arr['state_3_dn']='';
					//first
					if($value['state1']==1){
						$arr['state_1']='done';
						$arr['state_1_show']='top';
						$arr['state_1_time']=$res_send['state1_time'];
						$arr['state_1_dn']='';
					}else{
						$arr['state_1']='grey';
						$arr['state_1_show']='bottom';
						$arr['state_1_dn']='dn';
					}
					//second
					if($value['state2']==1){
						$arr['state_2']='done';
						$arr['state_2_show']='top';
						$arr['state_2_time']=$res_send['state2_time'];
						$arr['state_2_dn']='';
					}else{
					$arr['state_2']='grey';
					$arr['state_2_show']='bottom';
					$arr['state_2_dn']='dn';
					}
					//fourth
					if($value['state4']==0){
						$arr['state_4']='grey';
						$arr['state_4_value']='通知面试';
						$arr['state_4_show']='bottom';
						$arr['state_4_say']=$res_send['content'];
						$arr['state_4_dn']='dn';
					}elseif($value['state4']==1){
						$arr['state_4']='done';
						$arr['state_4_value']='通知面试';
						$arr['state_4_show']='top';
						$arr['state_4_time']=$res_send['state4_time'];
						$arr['state_4_say']=$res_send['content'];
						$arr['state_4_dn']='';
					}else{
						$arr['state_4']='done';
						$arr['state_4_value']='不合适';
						$arr['state_4_show']='top';
						$arr['state_4_time']=$res_send['state4_time'];
						$arr['state_4_say']=$res_send['content'];
						$arr['state_4_dn']='';
					}
					$res_job=$job->where("id={$arr['job_id']}")->find();
					if($res_job){
						$arr['job']=$res_job;
					}
					$res_company=$company->where("id={$arr['company_id']}")->find();
					if($res_company){
						$arr['company']=$res_company;
						$result[]=$arr;	
					}
				}			
			}
		}
		//显示用户投递的职位
		$this->assign('topshow',$topshow);
		$this->assign('data',$this->data);
		$this->assign('result',$result);
		$this->display('ResumeSend/index');			
	}
	//通知面试的简历
	public function noticeAudition(){
		$user=M('users');
		$id=session('user.id');
		$res_user=$user->where("id=$id")->find();
		if($res_user){
			$this->data['username']=$res_user['username'];
		}
		//投递职位的遍历
		$topshow['noticeAudition']='current';
		$send=M('send');
		$company=M('company');
		$job=M('job');
		$res_send=$send->where("user_id=$id")->select();
		if($res_send){
			foreach($res_send as $key=>$value){
				//second	
				if($value['state4']==1){
					$arr=$value;
					$arr['state_4']='done';
					$arr['state_4_value']='通知面试';
					$arr['state_4_show']='top';
					$arr['state_4_time']=$res_send['state4_time'];
					$arr['state_4_say']=$res_send['content'];
					$arr['state_4_dn']='';
					//first
					if($value['state1']==1){
						$arr['state_1']='done';
						$arr['state_1_show']='top';
						$arr['state_1_time']=$res_send['state1_time'];
						$arr['state_1_dn']='';
					}else{
						$arr['state_1']='grey';
						$arr['state_1_show']='bottom';
						$arr['state_1_dn']='dn';
					}
					//second
					if($value['state2']==1){
						$arr['state_2']='done';
						$arr['state_2_show']='top';
						$arr['state_2_time']=$res_send['state2_time'];
						$arr['state_2_dn']='';
					}else{
						$arr['state_2']='grey';
						$arr['state_2_show']='bottom';
						$arr['state_2_dn']='dn';
					}
					//third
					if($value['state3']==0){
						$arr['state_3']='grey';
						$arr['state_3_value']='被转发';
						$arr['state_3_show']='bottom';
						$arr['state_3_dn']='dn';
					}elseif($value['state3']==1){
						$arr['state_3']='done';
						$arr['state_3_value']='被转发';
						$arr['state_3_show']='top';
						$arr['state_3_time']=$res_send['state3_time'];
						$arr['state_3_dn']='';
					}else{
						$arr['state_3']='done';
						$arr['state_3_value']='通过初筛';
						$arr['state_3_show']='top';
						$arr['state_3_time']=$res_send['state3_time'];
						$arr['state_3_dn']='';
					}
					$res_job=$job->where("id={$arr['job_id']}")->find();
					if($res_job){
						$arr['job']=$res_job;
					}
					$res_company=$company->where("id={$arr['company_id']}")->find();
					if($res_company){
						$arr['company']=$res_company;
						$result[]=$arr;	
					}
				}			
			}
		}
		//var_dump($res_send);
		//显示用户投递的职位
		$this->assign('topshow',$topshow);
		$this->assign('data',$this->data);
		$this->assign('result',$result);
		$this->display('ResumeSend/index');	
	}
	//不合格的简历
	public function notBy(){
		$user=M('users');
		$id=session('user.id');
		$res_user=$user->where("id=$id")->find();
		if($res_user){
			$this->data['username']=$res_user['username'];
		}
		//投递职位的遍历
		$topshow['notby']='current';
		$send=M('send');
		$company=M('company');
		$job=M('job');
		$res_send=$send->where("user_id=$id")->select();
		if($res_send){
			foreach($res_send as $key=>$value){
				//second	
				if($value['state4']==2){
					$arr=$value;
					$arr['state_4']='done';
					$arr['state_4_value']='不合适';
					$arr['state_4_show']='top';
					$arr['state_4_time']=$res_send['state4_time'];
					$arr['state_4_say']=$res_send['content'];
					$arr['state_4_dn']='';
					//first
					if($value['state1']==1){
						$arr['state_1']='done';
						$arr['state_1_show']='top';
						$arr['state_1_time']=$res_send['state1_time'];
						$arr['state_1_dn']='';
					}else{
						$arr['state_1']='grey';
						$arr['state_1_show']='bottom';
						$arr['state_1_dn']='dn';
					}
					//second
					if($value['state2']==1){
						$arr['state_2']='done';
						$arr['state_2_show']='top';
						$arr['state_2_time']=$res_send['state2_time'];
						$arr['state_2_dn']='';
					}else{
						$arr['state_2']='grey';
						$arr['state_2_show']='bottom';
						$arr['state_2_dn']='dn';
					}
					//third
					if($value['state3']==0){
						$arr['state_3']='grey';
						$arr['state_3_value']='被转发';
						$arr['state_3_show']='bottom';
						$arr['state_3_dn']='dn';
					}elseif($value['state3']==1){
						$arr['state_3']='done';
						$arr['state_3_value']='被转发';
						$arr['state_3_show']='top';
						$arr['state_3_time']=$res_send['state3_time'];
						$arr['state_3_dn']='';
					}else{
						$arr['state_3']='done';
						$arr['state_3_value']='通过初筛';
						$arr['state_3_show']='top';
						$arr['state_3_time']=$res_send['state3_time'];
						$arr['state_3_dn']='';
					}
					$res_job=$job->where("id={$arr['job_id']}")->find();
					if($res_job){
						$arr['job']=$res_job;
					}
					$res_company=$company->where("id={$arr['company_id']}")->find();
					if($res_company){
						$arr['company']=$res_company;
						$result[]=$arr;	
					}
				}			
			}
		}
		$this->assign('topshow',$topshow);
		$this->assign('data',$this->data);
		$this->assign('result',$result);
		$this->display('ResumeSend/index');			
	}
}